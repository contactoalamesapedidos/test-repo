<!-- This file is intentionally empty as the header is included in layout.ejs -->

<% const isAdminArea = (typeof currentPath !== 'undefined' && currentPath.startsWith('/admin')); %>
<% if (!isAdminArea) { %>
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container-fluid d-flex align-items-center">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img src="/images/logo.jpeg" alt="A la Mesa" height="40" class="me-2">
        </a>

        <!-- Search Form for Desktop - Centered -->
        <div class="flex-grow-1 px-lg-4 d-none d-lg-block">
            <form action="/search" method="GET" class="w-100">
                <div class="input-group">
                    <input type="text" name="q" class="form-control" placeholder="Buscar restaurantes por nombre o comida..." aria-label="Buscar restaurantes">
                    <button class="btn btn-outline-primary" type="submit" aria-label="Buscar"><i class="fas fa-search"></i></button>
                </div>
            </form>
        </div>

        <!-- Botones en Desktop -->
        <div class="d-none d-lg-flex align-items-center ms-auto">
            <!-- Icono del carrito (solo para clientes) -->
            <% if (user && user.tipo_usuario !== 'restaurante' && user.tipo_usuario !== 'admin') { %>
                <div class="cart-icon-container me-3" style="cursor:pointer; position: relative;" title="Ver carrito">
                    <i class="fas fa-shopping-cart fa-lg"></i>
                    <span class="cart-badge bg-danger text-white" id="cartCountDesktop" data-cart-count style="position: absolute; top: -10px; right: -10px; font-size: 0.7em; padding: 0.3em 0.5em; border-radius: 50%; display: flex; align-items: center; justify-content: center; min-width: 18px; min-height: 18px;">0</span>
                </div>
            <% } %>
            <!-- User dropdown -->
            <% if (user) { %>
                <div class="dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user me-2"></i><%= user.nombre %>
                    </a>
                    <ul class="dropdown-menu">
                        <% if (user.tipo_usuario === 'admin') { %>
                            <li><a class="dropdown-item" href="/admin"><i class="fas fa-cogs me-2"></i>Panel Administrativo</a></li>
                        <% } else if (user.tipo_usuario === 'restaurante') { %>
                            <li><a class="dropdown-item" href="/dashboard" style="position: relative;"><i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                <% if (typeof pedidos_no_entregados !== 'undefined' && pedidos_no_entregados > 0) { %>
                                    <span class="badge bg-danger rounded-pill" style="position: absolute; top: 5px; right: 5px; font-size: 0.7em; padding: 0.3em 0.5em;"><%= pedidos_no_entregados %></span>
                                <% } %>
                            </a></li>
                        <% } else if (user.tipo_usuario === 'repartidor') { %>
                            <li><a class="dropdown-item" href="/repartidores"><i class="fas fa-motorcycle me-2"></i>Panel de Repartidor</a></li>
                        <% } %>
                        <li><a class="dropdown-item" href="/orders/history"><i class="fas fa-list me-2"></i>Mis pedidos</a></li>
                        <li><a class="dropdown-item" href="/auth/profile"><i class="fas fa-user-cog me-2"></i>Mi Perfil</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="/auth/logout"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesi贸n</a></li>
                    </ul>
                </div>
            <% } else { %>
                <a href="/auth/login" class="btn btn-outline-primary me-2">Iniciar Sesi贸n</a>
                <a href="/auth/register" class="btn" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; border: none;">Registrarse</a>
            <% } %>
        </div>
    </div>
</nav>
<% } %>

<% if (!user || user.tipo_usuario !== 'admin') { %>
  <!-- Eliminado nav mobile-nav duplicado del carrito -->
<% } %>

<style>
.cart-badge {
    position: absolute;
    top: -5px;
    right: -10px;
    font-size: 0.7em;
    padding: 0.3em 0.5em;
}
.cart-icon-container {
    position: relative;
    padding-right: 15px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Asegurar que el dropdown de usuario funcione en desktop
    const userDropdown = document.getElementById('userDropdown');

    // Asignar listeners al carrito (remplaza onclick inline)
    const cartIconContainers = document.querySelectorAll('.cart-icon-container');
    cartIconContainers.forEach(function(el) {
        el.addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof window.toggleCartSidebar === 'function') {
                window.toggleCartSidebar(e);
            }
        });
    });

    // Log extra para depuraci贸n del badge m贸vil
    setTimeout(function() {
      var badge = document.getElementById('cartCountMobile');
      if (badge) {
        
      } else {
        
      }
    }, 1000);
});
</script>
