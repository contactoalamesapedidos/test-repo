<%- include('mobile-nav') %>
<style>
    .info-card {
        background-color: #f8f9fa;
        border-left: 5px solid #007bff;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 5px;
    }
    .info-card h6 {
        font-weight: bold;
        color: #007bff;
    }
</style>

<div class="container mt-5 mb-5">
    <div class="row">
        <!-- Sidebar del Repartidor - Hidden on mobile -->
        <div class="col-md-3 d-none d-md-block">
            <%- include('sidebar', { activePage: 'estadisticas' }) %>
        </div>

        <!-- Contenido Principal -->
        <div class="col-md-9">
            <div class="card shadow-sm mb-4">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0">Estadísticas Detalladas</h4>
                        <p class="text-muted mb-0">
                            <% if (driver.restaurante_nombre) { %>
                                Repartidor de: <strong><%= driver.restaurante_nombre %></strong>
                            <% } else { %>
                                <strong>Repartidor Independiente</strong>
                            <% } %>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Estadísticas Detalladas -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Estadísticas Detalladas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Estadísticas Principales -->
                        <div class="col-lg-4 mb-4">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <div class="card-body text-center">
                                    <i class="fas fa-box fa-2x mb-3 opacity-75"></i>
                                    <h4 class="card-title mb-2">Total Entregas</h4>
                                    <h2 class="mb-0 fw-bold"><%= stats.totalEntregas %></h2>
                                    <small class="opacity-75">Pedidos completados</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-4">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                                <div class="card-body text-center">
                                    <i class="fas fa-dollar-sign fa-2x mb-3 opacity-75"></i>
                                    <h4 class="card-title mb-2">Ganancias Totales</h4>
                                    <h2 class="mb-0 fw-bold">$<%= gananciasTotales.toFixed(2) %></h2>
                                    <small class="opacity-75">Ingresos acumulados</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-4">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #2af598 0%, #009efd 100%); color: white;">
                                <div class="card-body text-center">
                                    <i class="fas fa-calendar-day fa-2x mb-3 opacity-75"></i>
                                    <h4 class="card-title mb-2">Ganancias de Hoy</h4>
                                    <h2 class="mb-0 fw-bold">$<%= stats.gananciasHoy.toFixed(2) %></h2>
                                    <small class="opacity-75">Ingresos de hoy</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticas Adicionales -->
                    <div class="row">
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card border-0 shadow-sm text-center h-100">
                                <div class="card-body">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-3 d-inline-block mb-3">
                                        <i class="fas fa-star text-primary fa-lg"></i>
                                    </div>
                                    <h6 class="card-title text-muted mb-2">Reputación</h6>
                                    <h4 class="mb-0 fw-bold text-primary"><%= stats.reputacion.toFixed(1) %></h4>
                                    <small class="text-muted">Calificación promedio</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card border-0 shadow-sm text-center h-100">
                                <div class="card-body">
                                    <div class="rounded-circle bg-success bg-opacity-10 p-3 d-inline-block mb-3">
                                        <i class="fas fa-check-circle text-success fa-lg"></i>
                                    </div>
                                    <h6 class="card-title text-muted mb-2">Pedidos de Hoy</h6>
                                    <h4 class="mb-0 fw-bold text-success"><%= stats.pedidosHoy %></h4>
                                    <small class="text-muted">Entregas hoy</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card border-0 shadow-sm text-center h-100">
                                <div class="card-body">
                                    <div class="rounded-circle bg-info bg-opacity-10 p-3 d-inline-block mb-3">
                                        <i class="fas fa-route text-info fa-lg"></i>
                                    </div>
                                    <h6 class="card-title text-muted mb-2">Distancia Total</h6>
                                    <h4 class="mb-0 fw-bold text-info"><%= stats.distanciaTotal.toFixed(2) %> km</h4>
                                    <small class="text-muted">Recorridos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3 mb-3">
                            <div class="card border-0 shadow-sm text-center h-100">
                                <div class="card-body">
                                    <div class="rounded-circle bg-warning bg-opacity-10 p-3 d-inline-block mb-3">
                                        <i class="fas fa-trophy text-warning fa-lg"></i>
                                    </div>
                                    <h6 class="card-title text-muted mb-2">Ranking</h6>
                                    <h4 class="mb-0 fw-bold text-warning">#<%= stats.ranking %></h4>
                                    <small class="text-muted">Entre repartidores</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráfico de Rendimiento -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0"><i class="fas fa-chart-area me-2"></i>Rendimiento Semanal</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="deliveryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('deliveryChart').getContext('2d');
    const entregasSemanales = <%- JSON.stringify(stats.entregasSemanales) %>;
    const labels = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
    const data = new Array(7).fill(0);
    entregasSemanales.forEach(entrega => {
        data[entrega.dia - 1] = entrega.entregas;
    });

    const deliveryChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Entregas',
                data: data,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<%- include('../partials/footer') %>
